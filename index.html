<!doctype html>

<meta charset=utf-8>
<title>Stellar Navigator</title>
<link href=bundle.css rel=stylesheet>
<body></body>
<script src=elm.js></script>
<script>
var session = Math.random()

const app = Elm.Main.fullscreen()

app.ports.pushPage.subscribe(function ([pos, title, url]) {
  if (location.href.split('/').slice(3).join('/') == '#' + url) {
    return
  }
  console.log('pushing to', pos)
  history.pushState({session: session, pos: pos}, title, '/#' + url)
})

app.ports.navigate.send(location.hash.slice(1))
history.replaceState({session: session, pos: 2}, document.title, '/' + location.hash)

window.onpopstate = function (e) {
  if (e.state === null || e.state.session !== session) {
    location.reload()
    return
  }

  let pos = e.state.pos
  console.log('will surf to', pos)
  app.ports.surf.send(pos)
}
</script>
